{% extends "base.html" %}

{% block content %}
<div class="card">
  <h2>Add meter reading</h2>
  <form method="post">
    <input type="hidden" name="action" value="reading">
    <div class="grid">
      <div>
        <label for="date">Date</label>
        <input type="date" id="date" name="date" value="{{ today }}">
      </div>
      <div>
        <label for="meter_reading">Meter reading (kWh)</label>
        <input type="number" step="0.01" id="meter_reading" name="meter_reading" required>
      </div>
    </div>
    <div style="margin-top: 0.8rem;">
      <button type="submit">Save reading</button>
    </div>
  </form>
  <p style="margin-top:0.6rem;font-size:0.8rem;color:#6b7280;">
    You can also enter older readings by picking a different date.
  </p>
</div>

<div class="card">
  <h2>Add offset (for meter replacement)</h2>
  <form method="post">
    <input type="hidden" name="action" value="offset">
    <div class="grid">
      <div>
        <label for="offset_date">Date from which this offset applies</label>
        <input type="date" id="offset_date" name="offset_date" value="{{ today }}" required>
      </div>
      <div>
        <label for="offset_kwh">Offset (kWh)</label>
        <input type="number" step="0.01" id="offset_kwh" name="offset_kwh" required>
      </div>
    </div>
    <div style="margin-top:0.8rem;">
      <button type="submit">Save offset</button>
    </div>
  </form>
  <p style="margin-top:0.6rem;font-size:0.8rem;color:#6b7280;">
    Example: if your old meter stopped at 12000 kWh and the new meter starts at 0,
    add an offset of 12000 kWh for the date the new meter started.
  </p>

  {% if offsets %}
    <h3 style="font-size:0.95rem;margin-top:0.9rem;">Existing offsets</h3>
    <table>
      <thead>
      <tr>
        <th>Date</th>
        <th>Offset kWh</th>
      </tr>
      </thead>
      <tbody>
      {% for o in offsets %}
        <tr>
          <td>{{ o.date.strftime("%d.%m.%Y") }}</td>
          <td>{{ o.offset_kwh }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>

<div class="card">
  <h2>Last readings (for reference)</h2>
  {% if readings %}
    <table>
      <thead>
      <tr>
        <th>Date</th>
        <th>Meter (kWh)</th>
      </tr>
      </thead>
      <tbody>
      {% for r in readings|reverse %}
        <tr>
          <td>{{ r.date.strftime("%d.%m.%Y") }}</td>
          <td>{{ "%.1f"|format(r.meter_reading) }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No readings yet.</p>
  {% endif %}
</div>
{% endblock %}
